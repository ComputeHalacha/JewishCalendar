(function(){"use strict";function s(){console.log("Cordova was recognized device ready has been fired.");document.addEventListener("pause",h.bind(this),!1);document.addEventListener("resume",c.bind(this),!1);r()}function h(){}function c(){r()}function r(){try{console.log("Attempting to acquire device location from Cordova geolocation plugin");navigator.geolocation.getCurrentPosition(function(n){var i=new Location("Current Location",undefined,n.coords.latitude,n.coords.longitude,Utils.currUtcOffset(),n.coords.altitude,Utils.isDST()),r;console.log("Location acquired from Cordova geolocation plugin.");$("#divMainPage").jqmData("location",i);console.log("Acquired location from geolocation plugin");console.info(n);t();f("Location set to Current position",!1,2,"Location set");r=getHarvey()},function(){u()})}catch(n){console.error(n.message);u()}}function f(n,t,i,r,u,f){navigator.notification?(navigator.notification.alert(n,u,r,f),t&&navigator.notification.beep(1)):l(n,t,i)}function l(n,t,i){var r=function(){$(this).remove()};$('<div class="toast">'+n+"<\/div>").addClass(t?"error":"").click(r).appendTo($.mobile.pageContainer).delay(i?i*1e3:t?15e3:1e3).fadeOut(1e3,r)}function a(){return $("#divMainPage").jqmData("location")||(!window.cordova?u():r()),$("#divMainPage").jqmData("location")}function u(){var n=localStorage.getItem("location");n?n=JSON.parse(n):(n=Location.getJerusalem(),localStorage.setItem("location",JSON.stringify(n)));f("Location set to: "+n.Name,!1,2,"Location set");$("#divMainPage").jqmData("location",n);t()}function t(n){if(n)$("#divMainPage").jqmData("currentjDate",n);else if($("#divMainPage").jqmData("currentjDate"))n=$("#divMainPage").jqmData("currentjDate");else{t(new jDate(new Date));return}var i=a();$("#h2Header").html(n.toStringHeb()+"<br />"+n.getDate().toDateString());$("#pSpecial").html(v(n,i));$("#divCaption").html("Zmanim for "+i.Name);$("#emLocDet").html("lat: "+i.Latitude.toString()+" long:"+i.Longitude.toString()+(i.Israel?" | Israel":"")+"  |  "+(i.IsDST?"DST":"not DST"));$("#pMain").html(y(n,i));$("#pMain").jqmData("currDate",n)}function i(n){var i=$("#divMainPage").jqmData("currentjDate");i&&t(i.addDays(n))}function e(n){var i=$("#divMainPage").jqmData("currentjDate");i&&t(i.addMonths(n))}function o(n){var i=$("#divMainPage").jqmData("currentjDate");i&&t(i.addYears(n))}function v(n,t){var i=n.getHolidays(t.Israel),r="";return i.length&&i.forEach(function(i){if(~i.indexOf("Mevarchim")){var u=n.addMonths(1);i+="<br />Molad: "+Molad.getString(u.Year,u.Month,t)}r+=i+"<br />"}),r}function y(t,i){var r="",o=t.getSunriseSunset(i),u=o.sunrise,f=o.sunset,s=t.getDafyomi(),h=t.getChatzos(i),e=t.getShaaZmanis(i),c=t.getShaaZmanis(i,90);return t.hasCandleLighting()&&(r+="<strong>Candle Lighting: "+Utils.getTimeString(t.getCandleLighting(i))+"<\/strong><br /><br />"),r+=n("Weekly Sedra",t.getSedra(i.Israel).map(function(n){return n.eng}).join(" - ")),s!=null&&(r+=n("Daf Yomi",s)),isNaN(u.hour)?r+=n("Netz Hachama","The does not rise"):(r+=n("Alos Hashachar - 90",Utils.addMinutes(u,-90)),r+=n("Alos Hashachar - 72",Utils.addMinutes(u,-72)),r+=n("Netz Hachama",u),r+=n('Krias Shma - MG"A',Utils.addMinutes(Utils.addMinutes(u,-90),parseInt(c*3))),r+=n('Krias Shma - GR"A',Utils.addMinutes(u,parseInt(e*3))),r+=n('Zeman Tefillah - MG"A',Utils.addMinutes(Utils.addMinutes(u,-90),parseInt(c*4))),r+=n('Zeman Tefillah - GR"A',Utils.addMinutes(u,parseInt(e*4)))),isNaN(u.hour)||isNaN(f.hour)||(r+=n("Chatzos - Day & Night",h),r+=n("Mincha Gedolah",Utils.addMinutes(h,parseInt(e*.5)))),isNaN(f.hour)?r+=n("Shkias Hachama","The sun does not set"):(r+=n("Shkias Hachama",f),r+=n("Nightfall 45",Utils.addMinutes(f,45)),r+=n("Rabbeinu Tam",Utils.addMinutes(f,72))),r}function n(n,t){return n+"...............<strong>"+(t.hour?Utils.getTimeString(t):t)+"<\/strong><br />"}$(document).on("pagecreate","#divMainPage",function(){$("#btnNextDay").on("click",function(){i(1)});$("#btnNextWeek").on("click",function(){i(7)});$("#btnNextMonth").on("click",function(){e(1)});$("#btnNextYear").on("click",function(){o(1)});$("#btnPrevWeek").on("click",function(){i(-7)});$("#btnPrevMonth").on("click",function(){e(-1)});$("#btnPrevYear").on("click",function(){o(-1)}).on("swipeup","#divMainPage",function(){i(-1)}).on("swipedown","#divMainPage",function(){i(1)});window.cordova||(console.log("Cordova not recognized, showing default location and date."),t())});document.addEventListener("deviceready",s.bind(this),!1)})();